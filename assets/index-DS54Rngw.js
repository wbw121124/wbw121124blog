function e(e){return"operator"===e.type&&"|"===e.value}function t(e){return"operator"===e.type&&"‚à•"===e.value}function n(e){if(e.length<2)return;const t=e.at(0);"OperatorLiteral"===t?.type&&"‚à•"===t.value&&(t.value="‚Äñ");const n=e.at(-1);"OperatorLiteral"===n?.type&&"‚à•"===n.value&&(n.value="‚Äñ")}function a(e){let t=e;for(;t&&("Term"===t.type||"UnaryOperation"===t.type||"BinaryOperation"===t.type||"TernaryOperation"===t.type);)[t]=t.items;t&&"OperatorLiteral"===t.type&&(t.attrs||(t.attrs={}),void 0===t.attrs.lspace&&(t.attrs.lspace=0))}function r(e){return"sep.row"===e.type||"sep.col"===e.type||"infix"===e.type&&("sub"===e.value||"sup"===e.value)}function o(e){if(!e)return[];if("SpaceLiteral"===e.at(-1)?.type&&e.pop(),1!==e.length)return e;const[t]=e;if("FencedGroup"!==t.type||1!==t.items.length)return e;const[n]=t.items;if(1===n.length){const[t]=n;if(("Term"===t.type&&1===t.items.length?t.items[0]:t).type.endsWith("Literal"))return e}return[{type:"Term",items:n}]}function s(e){let t=e.start+1,n=e.tokens.at(t);const a=[];let s=null,l=null;function u(){(s&&s.length>0||l&&l.length>0)&&a.push([o(s),o(l)]),s=null,l=null}let i=n?.value??"sub";for(;n&&r(n);){"infix"===n.type&&(i=n.value),t+=1,n=e.tokens[t],n&&"space"===n.type&&(t+=1,n=e.tokens[t]);const a=[];for(;n&&"paren.close"!==n.type&&!r(n);){const r=x({...e,start:t,stack:[],nestLevel:e.nestLevel+1,stopAt:e=>"infix"===e.type&&("sub"===e.value||"sup"===e.value)});a.push(r.node),t=r.end,n=e.tokens[t]}"sup"===i?(l&&u(),l=a):(s&&u(),s=a)}return(s||l)&&u(),"paren.close"===n?.type&&(t+=1),{scripts:a,end:t}}function l(e){const{type:t,...n}=e;return n}function u(e){let t=e.start,n=e.tokens[t];const r=n,o=[];let u=[],i=[];const c=[];if(t+=1,n=e.tokens[t],n&&"space"===n.type&&(t+=1,n=e.tokens[t]),n&&"infix"===n.type&&("sub"===n.value||"sup"===n.value))return function(e){let t,n,{scripts:a,end:r}=s(e),o=e.tokens.at(r);if(o&&"space"!==o.type){n=a,a=[];const l=x({...e,start:r,stack:[],nestLevel:e.nestLevel+1,stopAt:e=>"paren.open"===e.type});if(t=l.node,r=l.end,o=e.tokens[r],"paren.open"===o?.type){const t=e.tokens.at(r+1);"infix"!==t?.type||"sub"!==t.value&&"sup"!==t.value||({scripts:a,end:r}=s({...e,start:r}))}}else t=e.stack.pop(),"SpaceLiteral"===t?.type&&(t={type:"Term",items:[]});const l={type:"MultiScripts",base:t??{type:"Term",items:[]},post:a};return n&&(l.pre=n),{node:l,end:r}}({...e,start:t-1});for(;n&&"paren.close"!==n.type;){if("space"===n.type&&" "===n.value){t+=1,n=e.tokens[t];continue}if("sep.col"===n.type){const a={value:n.value};n.attrs&&(a.attrs=n.attrs),o.push(a),i.push(u),u=[],t+=1,n=e.tokens[t],n&&"space"===n.type&&(t+=1,n=e.tokens[t]);continue}if("sep.row"===n.type){i.push(u),c.push(i),u=[],i=[],t+=1,n=e.tokens[t],n&&"space"===n.type&&(t+=1,n=e.tokens[t]);continue}1===u.length&&a(u[0]);const r=x({...e,start:t,stack:u,nestLevel:e.nestLevel+1});u.push(r.node),t=r.end,n=e.tokens[t]}u.length>0&&i.push(u);const p=t+1,m=n&&"paren.close"===n.type?n:null,v={open:l(r),close:m?l(m):null,seps:o};if("|"!==v.close?.value||r.value||(v.close.attrs||(v.close.attrs={}),v.close.attrs.lspace="0.35ex"),0===c.length)return{node:{type:"FencedGroup",items:i,attrs:v},end:p};const f=c;return i.length>0&&f.push(i),{node:{type:"MatrixGroup",items:f,attrs:v},end:p}}function i(e,t){if("Term"===e.type&&e.items.length>0){const[n,...a]=e.items;return{...e,items:[i(n,t),...a]}}if("BinaryOperation"===e.type){const[n,a]=e.items;return{...e,items:[i(n,t),a]}}if("TernaryOperation"===e.type){const[n,a,r]=e.items;return{...e,items:[i(n,t),a,r]}}return{type:"UnaryOperation",name:"command",transforms:t,items:[e]}}function c(e){return 1===e.length?e[0]:{type:"Term",items:e}}function p(n){const{tokens:a,start:r}=n,o=a[r],s=n.nestLevel+1;if(!o.name)throw new Error("Got prefix token without a name");const l=function({start:n,tokens:a,stack:r,stopAt:o}){if(o)return o;if(1!==r.length)return;const s=a[n];if(!s||s.arity&&1!==s.arity)return;const l=n>0?a[n-1]:void 0;return l&&"operator"===l.type?"|"===l.value?e:"‚à•"===l.value?t:void 0:void 0}(n);let u=x({...n,stack:[],start:r+1,nestLevel:s,stopAt:l});if(u&&u.node&&"SpaceLiteral"===u.node.type&&(u=x({...n,stack:[],start:u.end,nestLevel:s,stopAt:l})),2===o.arity){if(u&&u.node&&"FencedGroup"===u.node.type&&2===u.node.items.length){const[e,t]=u.node.items,n="root"===o.name?[c(t),c(e)]:[c(e),c(t)];return{node:{type:"BinaryOperation",name:o.name,attrs:o.attrs,items:n},end:u.end}}const e=u;let t=u&&x({...n,stack:[],start:u.end,nestLevel:s});t&&t.node&&"SpaceLiteral"===t.node.type&&(t=x({...n,stack:[],start:t.end,nestLevel:s}));const a={type:"BinaryOperation",name:o.name,items:[e.node,t.node]};return"root"===o.name&&(a.items=[t.node,e.node]),o.attrs&&(a.attrs=o.attrs),{node:a,end:t.end}}const i={type:"UnaryOperation",name:o.name,items:[u.node]};return o.accent&&(i.accent=o.accent),o.attrs&&(i.attrs=o.attrs),u&&u.node&&"FencedGroup"===u.node.type&&1===u.node.items.length&&(i.items=[c(u.node.items[0])]),{node:i,end:u.end}}function m(e){const t=e.tokens[e.start],n=t.value.startsWith("\n")?0:t.value.length;return{node:{type:"SpaceLiteral",attrs:{width:(a=n,a<=0?0:a<=3?.35*(a-1):a<=5?.5*(a-1):a-3)+"ex"}},end:e.start+1};var a}const v=e=>({start:t,tokens:n})=>{const{value:a,attrs:r}=n[t],o={type:`${e}Literal`,value:a};return r&&(o.attrs=r),{node:o,end:t+1}},f=[["command",function(n){const a=n.tokens[n.start];if(!a.name)throw new Error("Got command token without a name");const r=[],o=new Map;function s({name:e,value:t}){t&&("text-transform"===e?r.push(t):e&&o.set(e,t))}const l=function({start:n,tokens:a,stack:r,stopAt:o}){if(o)return o;if(1!==r.length)return;const s=n>0?a[n-1]:void 0;return s&&"operator"===s.type?"|"===s.value?e:"‚à•"===s.value?t:void 0:void 0}(n);s(a);let u=n.start+1,c=n.tokens[u];for(;c&&("command"===c.type||"space"===c.type);)"command"===c.type&&s(c),u+=1,c=n.tokens[u];const p=x({...n,stack:[],start:u,nestLevel:n.nestLevel+1,textTransforms:r,stopAt:l});if(0===r.length)return{node:{type:"UnaryOperation",name:"command",styles:o,items:[p.node]},end:p.end};const m=i(p.node,r);return o.size>0?{node:{type:"UnaryOperation",name:"command",styles:o,items:[m]},end:p.end}:{node:m,end:p.end}}],["ident",v("Ident")],["number",v("Number")],["operator",v("Operator")],["text",v("Text")],["infix",k],["paren.open",u],["prefix",p],["space",m]],d=new Map(f);const g=["ident","number","operator","text"];function h(e){return function(e){if("frac"!==e.name)return e;for(const t of e.items)a(t);return e}(function(e){const t=e;return t.items.forEach((n,a)=>{if("FencedGroup"!==n.type||1!==n.items.length)return;if(0===a&&"frac"!==e.name)return;const[r]=n.items;if(1!==r.length)return void(t.items[a]={type:"Term",items:r});const[o]=r,s="Term"===o.type&&1===o.items.length?o.items[0]:o;s.type.endsWith("Literal")||(t.items[a]=s)}),t}(function(e){const t=e,[n]=e.items;return"OperatorLiteral"!==n.type?t:"sub"===e.name&&["lim","‚àë","‚àè","‚ãÇ","‚ãÉ","‚ãÄ","‚ãÅ"].includes(n.value)?(t.name="under",t):"subsup"===e.name&&["‚àë","‚àè","‚ãÇ","‚ãÉ","‚ãÄ","‚ãÅ"].includes(n.value)?(t.name="underover",t):t}(e)))}function y(e,t,n){if("sub"===t.name&&"sup"===e){const[e,a]=t.items;return{type:"TernaryOperation",name:"subsup",items:[e,a,n]}}if("sup"===t.name&&"sub"===e){const[e,a]=t.items;return{type:"TernaryOperation",name:"subsup",items:[e,n,a]}}if("under"===t.name&&("over"===e||"sup"===e)){const[e,a]=t.items;return{type:"TernaryOperation",name:"underover",items:[e,a,n]}}if("over"===t.name&&("under"===e||"sub"===e)){const[e,a]=t.items;return{type:"TernaryOperation",name:"underover",items:[e,n,a]}}const a=h({type:"BinaryOperation",name:e,items:[t,n]});return b(a.name,a.items)}function b(e,[t,n]){if("BinaryOperation"!==t.type||"frac"===e)return{type:"BinaryOperation",name:e,items:[t,n]};const[a,r]=t.items;return{type:"BinaryOperation",name:t.name,items:[a,b(e,[r,n])]}}function k(e){const{tokens:t,start:a,stack:r}=e,o=e.nestLevel+1,s=t[a];let l;!function(e){if(e.length<3)return!1;const t=e.at(0),n=e.at(-1);return"OperatorLiteral"===t?.type&&"OperatorLiteral"===n?.type&&("|"===t.value||"‚à•"===t.value||"‚Äñ"===t.value)&&t.value===n.value}(r)?(l=r.pop(),"SpaceLiteral"===l?.type&&(l=r.pop())):(n(r),l={type:"Term",items:[...r]},r.splice(0,r.length)),l||(l={type:"Term",items:[]});const u=t[a+1];let i;if(u&&g.includes(u.type)){const t=d.get(u.type);if(!t)throw new Error("Unknown handler");i=t({...e,stack:[],start:a+1,nestLevel:o})}else i=x({...e,stack:[],start:a+1,nestLevel:o});i&&i.node&&"SpaceLiteral"===i.node.type&&(i=x({...e,stack:[],start:i.end,nestLevel:o}));const{end:c,node:p}=i;return"BinaryOperation"===l.type?{end:c,node:h(y(s.value,l,p))}:{end:c,node:h({type:"BinaryOperation",name:s.value,items:[l,p]})}}const w=["command","ident","infix","number","operator","paren.open","prefix","text"];function x(e){if(e.start>=e.tokens.length)return{node:{type:"Term",items:[]},end:e.start};const{type:t}=e.tokens[e.start];return"paren.open"===t?u(e):"space"===t?m(e):"infix"===t?k(e):"prefix"===t?p(e):function(e){let t=e.start,a=e.tokens[t];const r=[];for(;a&&w.includes(a.type)&&!e.stopAt?.(a);){const n=d.get(a.type);if(!n)throw new Error("Unknown Hander");const o=n({...e,start:t,stack:r});r.push(o.node),t=o.end,a=e.tokens[t]}return function(e,t){if(e.length<2)return;const[n,a]=e;if("IdentLiteral"!==n.type||"d"!==n.value)return;let r=a;for(;"UnaryOperation"===r.type||"BinaryOperation"===r.type||"TernaryOperation"===r.type;)[r]=r.items;if("IdentLiteral"!==r.type)return;const o=(t?.length??0)>0?n.value:"ùëë",s={...e[0],type:"OperatorLiteral",value:o,attrs:{...n.attrs??{},rspace:"0"}};e[0]=s}(r,e.textTransforms),n(r),{node:{type:"Term",items:r},end:t}}(e)}function L(e,{bare:t}){let n;if(n="math"===e.tag&&t?document.createDocumentFragment():document.createElementNS("http://www.w3.org/1998/Math/MathML",e.tag),n instanceof Element&&e.attrs)for(const[a,r]of Object.entries(e.attrs))n.setAttribute(a,`${r}`);if(e.textContent&&(n.textContent=e.textContent),e.childNodes)for(const a of e.childNodes)a&&n.appendChild(L(a,{bare:!1}));return n}function O(e,{bare:t}){const n=Object.entries(e.attrs||{}).map(([e,t])=>{return`${e}="${n=`${t}`,n.replace(/"/g,"&quot;")}"`;var n}).join(" "),a=n?`${e.tag} ${n}`:e.tag;if(e.textContent){return`<${a}>${e.textContent.replace(/[&<]/g,e=>"&"===e?"&amp;":"&lt;")}</${e.tag}>`}if(e.childNodes){const n=e.childNodes.map(e=>e?O(e,{bare:!1}):"").join("");return"math"===e.tag&&t?n:`<${a}>${n}</${e.tag}>`}return`<${a} />`}function M(e,t,n){if(!e)throw new Error("updateDOM called on null");if(e.tagName.toLowerCase()!==t.tag)throw new Error("tag name mismatch");if("math"!==t.tag||!n.bare){const n=t.attrs||{},a=[];for(const t of e.attributes){const r=n[t.name];r?r!==t.value&&e.setAttribute(t.name,`${r}`):a.push(t.name)}for(const t of a)e.removeAttribute(t);for(const[t,r]of Object.entries(n))e.getAttribute(t)||e.setAttribute(t,`${r}`)}if(["mi","mn","mo","mspace","mtext"].includes(t.tag))return void(e.textContent!==t.textContent&&(e.textContent=t.textContent??""));const a=[],r=[],o=[];for(const[s,l]of function*(e){const t=e.map(e=>e?e[Symbol.iterator]():function*(){}());for(;;){const e=t.map(e=>e.next());if(e.every(({done:e})=>e))return;yield e.map(({value:e})=>e)}}([e.children,t.childNodes]))(s||l)&&(l?s?s.tagName.toLowerCase()!==l.tag?o.push([s,L(l,n)]):M(s,l,{bare:!1}):a.push(L(l,n)):r.push(s));for(const s of r)e.removeChild(s);for(const s of a)e.appendChild(s);for(const[s,l]of o)e.replaceChild(l,s)}const N=new RegExp("^\\p{L}","u");function $(e){return!!e&&N.test(e)}const T=/^[\p{L}\p{N}]/u;function C(e){return!!e&&T.test(e)}const S=new RegExp("^\\p{M}","u");function A(e){return!!e&&S.test(e)}const E=/^[\p{N}\u{218a}-\u{218b}]/u;function B(e){return!!e&&E.test(e)}const _=/^[\p{P}\p{Sm}\p{So}\u{2061}-\u{2064}]/u;const G=new RegExp("^\\p{Pe}","u");function F(e){return!!e&&G.test(e)}const I=new RegExp("^\\p{Ps}","u");const P={class:"mathup-function-ident"},R=new Map([["CC",{value:"‚ÑÇ"}],["Delta",{value:"Œî",attrs:{mathvariant:"normal"}}],["Gamma",{value:"Œì",attrs:{mathvariant:"normal"}}],["Lambda",{value:"Œõ",attrs:{mathvariant:"normal"}}],["NN",{value:"‚Ñï"}],["O/",{value:"‚àÖ"}],["Omega",{value:"Œ©",attrs:{mathvariant:"normal"}}],["Phi",{value:"Œ¶",attrs:{mathvariant:"normal"}}],["Pi",{value:"Œ†",attrs:{mathvariant:"normal"}}],["Psi",{value:"Œ®",attrs:{mathvariant:"normal"}}],["QQ",{value:"‚Ñö"}],["RR",{value:"‚Ñù"}],["Sigma",{value:"Œ£",attrs:{mathvariant:"normal"}}],["Theta",{value:"Œò",attrs:{mathvariant:"normal"}}],["Xi",{value:"Œû",attrs:{mathvariant:"normal"}}],["ZZ",{value:"‚Ñ§"}],["alpha",{value:"Œ±"}],["beta",{value:"Œ≤"}],["chi",{value:"œá"}],["cos",{value:"cos",attrs:{...P}}],["cosh",{value:"cosh",attrs:{...P}}],["cot",{value:"cot",attrs:{...P}}],["csc",{value:"csc",attrs:{...P}}],["cosec",{value:"cosec",attrs:{...P}}],["delta",{value:"Œ¥"}],["det",{value:"det",attrs:{...P}}],["dim",{value:"dim",attrs:{...P}}],["epsilon",{value:"…õ"}],["eta",{value:"Œ∑"}],["gamma",{value:"Œ≥"}],["gcd",{value:"gcd",attrs:{...P}}],["iota",{value:"Œπ"}],["kappa",{value:"Œ∫"}],["lambda",{value:"Œª"}],["lcm",{value:"lcm",attrs:{...P}}],["ln",{value:"ln",attrs:{...P}}],["log",{value:"log",attrs:{...P}}],["max",{value:"max",attrs:{...P}}],["min",{value:"min",attrs:{...P}}],["mu",{value:"Œº"}],["nu",{value:"ŒΩ"}],["omega",{value:"œâ"}],["oo",{value:"‚àû"}],["phi",{value:"œÜ"}],["phiv",{value:"œï"}],["pi",{value:"œÄ"}],["psi",{value:"œà"}],["rho",{value:"œÅ"}],["sec",{value:"sec",attrs:{...P}}],["sigma",{value:"œÉ"}],["sin",{value:"sin",attrs:{...P}}],["sinh",{value:"sinh",attrs:{...P}}],["tan",{value:"tan",attrs:{...P}}],["tanh",{value:"tanh",attrs:{...P}}],["tau",{value:"œÑ"}],["theta",{value:"Œ∏"}],["upsilon",{value:"œÖ"}],["xi",{value:"Œæ"}],["zeta",{value:"Œ∂"}]]),U=new Map([["-",{value:"‚àí"}],["!=",{value:"‚â†"}],["!==",{value:"‚â¢"}],["!in",{value:"‚àâ"}],[".$",{value:"‚Å°",attrs:{class:"mathup-function-application"}}],[".*",{value:"‚Å¢",attrs:{class:"mathup-invisible-times"}}],[".+",{value:"‚Å§",attrs:{class:"mathup-invisible-add"}}],[".,",{value:"‚Å£",attrs:{class:"mathup-invisible-separator"}}],["'",{value:"‚Ä≤",attrs:{lspace:0,rspace:0}}],["''",{value:"‚Ä≥",attrs:{lspace:0,rspace:0}}],["'''",{value:"‚Ä¥",attrs:{lspace:0,rspace:0}}],["''''",{value:"‚Åó",attrs:{lspace:0,rspace:0}}],["*",{value:"¬∑"}],["**",{value:"‚àó"}],["***",{value:"‚ãÜ"}],["+-",{value:"¬±"}],["-+",{value:"‚àì"}],["-:",{value:"√∑"}],["-<",{value:"‚â∫"}],["-<=",{value:"‚™Ø"}],["-=",{value:"‚â°"}],["->",{value:"‚Üí"}],["->>",{value:"‚Ü†"}],["...",{value:"‚Ä¶"}],["//",{value:"‚ÅÑ"}],["/_",{value:"‚à†"}],["/_\\",{value:"‚ñ≥"}],[":.",{value:"‚à¥"}],[":|:",{value:"|",attrs:{stretchy:!0},sep:!0}],["<-",{value:"‚Üê"}],["<<<",{value:"‚â™"}],["<=",{value:"‚â§"}],["<=>",{value:"‚áî"}],["<>",{value:"‚ãÑ"}],["<|",{value:"‚ä≤"}],["==",{value:"‚â°"}],["=>",{value:"‚áí"}],[">-",{value:"‚âª"}],[">-=",{value:"‚™∞"}],[">->",{value:"‚Ü£"}],[">->>",{value:"‚§ñ"}],["><|",{value:"‚ãä"}],[">=",{value:"‚â•"}],[">>>",{value:"‚â´"}],["@",{value:"‚àò"}],["AA",{value:"‚àÄ"}],["EE",{value:"‚àÉ"}],["TT",{value:"‚ä§"}],["[]",{value:"‚ñ°"}],["^^",{value:"‚àß"}],["^^^",{value:"‚ãÄ"}],["_|_",{value:"‚ä•"}],["aleph",{value:"‚Ñµ"}],["and",{value:"and"}],["cdots",{value:"‚ãØ"}],["darr",{value:"‚Üì"}],["ddots",{value:"‚ã±"}],["del",{value:"‚àÇ"}],["diamond",{value:"‚ãÑ"}],["dint",{value:"‚à¨"}],["grad",{value:"‚àá"}],["hArr",{value:"‚áî"}],["harr",{value:"‚Üî"}],["if",{value:"if"}],["iff",{value:"‚áî"}],["in",{value:"‚àà"}],["int",{value:"‚à´"}],["lArr",{value:"‚áê"}],["larr",{value:"‚Üê"}],["lim",{value:"lim"}],["mod",{value:"mod"}],["nn",{value:"‚à©"}],["nnn",{value:"‚ãÇ"}],["not",{value:"¬¨"}],["o+",{value:"‚äï"}],["o.",{value:"‚äô"}],["oc",{value:"‚àù"}],["oint",{value:"‚àÆ"}],["or",{value:"or"}],["otherwise",{value:"otherwise"}],["ox",{value:"‚äó"}],["prod",{value:"‚àè"}],["prop",{value:"‚àù"}],["rArr",{value:"‚áí"}],["rarr",{value:"‚Üí"}],["square",{value:"‚ñ°"}],["sub",{value:"‚äÇ"}],["sube",{value:"‚äÜ"}],["sum",{value:"‚àë"}],["sup",{value:"‚äÉ"}],["supe",{value:"‚äá"}],["uarr",{value:"‚Üë"}],["uu",{value:"‚à™"}],["uuu",{value:"‚ãÉ"}],["vdots",{value:"‚ãÆ"}],["vv",{value:"‚à®"}],["vvv",{value:"‚ãÅ"}],["xx",{value:"√ó"}],["|--",{value:"‚ä¢"}],["|->",{value:"‚Ü¶"}],["|==",{value:"‚ä®"}],["|>",{value:"‚ä≥"}],["|><",{value:"‚ãâ"}],["|><|",{value:"‚ãà"}],["||",{value:"‚à•"}],["~=",{value:"‚âÖ"}],["~~",{value:"‚âà"}]]),W=new Map([["(:",{value:"‚ü®"}],["<<",{value:"‚ü®"}],["{:",{value:""}],["|(",{value:"|"}],["|:",{value:"|"}],["|__",{value:"‚åä"}],["||(",{value:"‚Äñ"}],["||:",{value:"‚Äñ"}],["|~",{value:"‚åà"}],["(mod",{value:"(",attrs:{lspace:"1.65ex"},extraTokensAfter:[{type:"operator",value:"mod",attrs:{lspace:0}}]}]]),j=new Map([[")|",{value:"|"}],[")||",{value:"‚Äñ"}],[":)",{value:"‚ü©"}],[":|",{value:"|"}],[":||",{value:"‚Äñ"}],[":}",{value:""}],[">>",{value:"‚ü©"}],["__|",{value:"‚åã"}],["~|",{value:"‚åâ"}]]),D=new Map([["bar",{name:"over",accent:"‚Äæ"}],["ddot",{name:"over",accent:"‚ãÖ‚ãÖ"}],["dot",{name:"over",accent:"‚ãÖ"}],["hat",{name:"over",accent:"^"}],["obrace",{name:"over",accent:"‚èû"}],["obracket",{name:"over",accent:"‚é¥"}],["oparen",{name:"over",accent:"‚èú"}],["oshell",{name:"over",accent:"‚è†"}],["tilde",{name:"over",accent:"Àú"}],["ubrace",{name:"under",accent:"‚èü"}],["ubrace",{name:"under",accent:"‚èü"}],["ubracket",{name:"under",accent:"‚éµ"}],["ul",{name:"under",accent:"_"}],["uparen",{name:"under",accent:"‚èù"}],["ushell",{name:"under",accent:"‚è°"}],["vec",{name:"over",accent:"‚Üí"}],["abs",{name:"fence",attrs:{open:"|",close:"|"}}],["binom",{name:"frac",arity:2,attrs:{linethickness:0,open:"(",close:")"}}],["ceil",{name:"fence",attrs:{open:"‚åà",close:"‚åâ"}}],["floor",{name:"fence",attrs:{open:"‚åä",close:"‚åã"}}],["norm",{name:"fence",attrs:{open:"‚Äñ",close:"‚Äñ"}}],["root",{name:"root",arity:2}],["sqrt",{name:"sqrt"}],["cancel",{name:"row",attrs:{class:"mathup-enclose-cancel"}}]]),q=new Map([["rm",{name:"text-transform",value:"normal"}],["bf",{name:"text-transform",value:"bold"}],["it",{name:"text-transform",value:"italic"}],["bb",{name:"text-transform",value:"double-struck"}],["cc",{name:"text-transform",value:"script"}],["tt",{name:"text-transform",value:"monospace"}],["fr",{name:"text-transform",value:"fraktur"}],["sf",{name:"text-transform",value:"sans-serif"}],["black",{name:"color",value:"black"}],["‚ö´",{name:"color",value:"black"}],["blue",{name:"color",value:"blue"}],["üîµ",{name:"color",value:"blue"}],["brown",{name:"color",value:"brown"}],["üü§",{name:"color",value:"brown"}],["cyan",{name:"color",value:"cyan"}],["gray",{name:"color",value:"gray"}],["green",{name:"color",value:"green"}],["üü¢",{name:"color",value:"green"}],["lightgray",{name:"color",value:"lightgray"}],["orange",{name:"color",value:"orange"}],["üü†",{name:"color",value:"orange"}],["purple",{name:"color",value:"purple"}],["üü£",{name:"color",value:"purple"}],["red",{name:"color",value:"red"}],["üî¥",{name:"color",value:"red"}],["white",{name:"color",value:"white"}],["‚ö™",{name:"color",value:"white"}],["yellow",{name:"color",value:"yellow"}],["üü°",{name:"color",value:"yellow"}],["bg.black",{name:"background",value:"black"}],["‚¨õ",{name:"background",value:"black"}],["bg.blue",{name:"background",value:"blue"}],["üü¶",{name:"background",value:"blue"}],["bg.brown",{name:"background",value:"brown"}],["üü´",{name:"background",value:"brown"}],["bg.cyan",{name:"background",value:"cyan"}],["bg.gray",{name:"background",value:"gray"}],["bg.green",{name:"background",value:"green"}],["üü©",{name:"background",value:"green"}],["bg.lightgray",{name:"background",value:"lightgray"}],["bg.orange",{name:"background",value:"orange"}],["üüß",{name:"background",value:"orange"}],["bg.purple",{name:"background",value:"purple"}],["üü™",{name:"background",value:"purple"}],["bg.red",{name:"background",value:"red"}],["üü•",{name:"background",value:"red"}],["bg.white",{name:"background",value:"white"}],["‚¨ú",{name:"background",value:"white"}],["bg.yellow",{name:"background",value:"yellow"}],["üü®",{name:"background",value:"yellow"}]]);function H(e,t,n,{offset:a=0}={}){let r=0;for(;n[t+a+r]===e;)r+=1;let o="",s=0,l=t+a+r;for(;s<r&&!(l>=n.length);)n[l]===e?s+=1:(s>0&&(o+=e.repeat(s),s=0),o+=n[l]),l+=1;return{value:o.trim(),end:l}}function Z(e,t,n){return H("`",e,t,n)}function z(e,t,n){const a=t+e.length;let r="",[o]=n.slice(a);if(!o)return{value:e,end:a};if(C(o)){for(;C(o);)r+=o,[o]=n.slice(a+r.length);return{value:r,end:a+r.length}}return"`"===o?Z(t,n,{offset:e.length}):{value:o,end:a+o.length}}function Q(e,t,n){let a=t,r=e.at(a);for(;" "===r||"\n"===r;)a+=1,r=e.at(a);return!!r&&!(n&&(F(r)||function(e,t){for(const n of j.keys())if(e.startsWith(n,t))return!0;return!1}(e,a)))}const X=new Map([["^","sup"],["/","frac"],["_","sub"],[".^","over"],["._","under"]]),J=new Set;for(const Pe of[q,R,U,j,W,D])for(const e of Pe.keys())"^/_".includes(e[0])&&J.add(e);function K(e){for(const[t]of U)if(t.startsWith(e))return!0;return!1}function V(e){for(const[t]of j)if(t.startsWith(e))return!0;return!1}function Y(e){for(const[t]of W)if(t.startsWith(e))return!0;return!1}const ee=[function(e,t,{start:n}){if(" "!==e)return null;let a=n,r=e,o="";for(;" "===r;)o+=r,a+=1,r=t[a];return{type:"space",value:o,end:a}},function(e,t,{start:n,grouping:a}){if(!$(e))return null;let r=e,o="";for(;$(r)||A(r)||o.length>0&&"."===r;){const e=n+o.length+r.length;o+=r,[r]=t.slice(e)}o.endsWith(".")&&(o=o.slice(0,-1));let s=n+o.length;{const e=U.get(o);if(e)return{type:"operator",value:e.value,attrs:e.attrs,end:n+o.length}}{const e=R.get(o);if(e)return{type:"ident",value:e.value,attrs:e.attrs,end:n+o.length}}const l=`${o}${r}`,[u]=t.slice(n+l.length);{const e=U.get(l);if(e&&!C(u))return{type:"operator",value:e.value,attrs:e.attrs,end:n+l.length}}{const e=R.get(l);if(e&&!C(u))return{type:"ident",value:e.value,attrs:e.attrs,end:n+l.length}}{const e=D.get(o);if(e&&(function(e){return"root"===e.name||"sqrt"===e.name}(e)||Q(t,s,a)))return{type:"prefix",value:"",end:s,...e}}{const e=q.get(o);if(e&&Q(t,s,a))return{type:"command",end:s,...e}}return o.includes(".")&&(o=o.slice(0,o.indexOf(".")),s=n+o.length),{type:"ident",value:o,end:s,split:!0}},function(e,t,{start:n},{decimalMark:a}){if(!B(e))return null;let r=e,o="";for(;B(r);)o+=r,[r]=t.slice(n+o.length);if(r===a&&([r]=t.slice(n+o.length+a.length),B(r)))for(o+=a;B(r);)o+=r,[r]=t.slice(n+o.length);return{type:"number",value:o,end:n+o.length}},function(e,t,{start:n}){if("`"!==e)return null;const{end:a,value:r}=Z(n,t);return{type:"ident",value:r,end:a}},function(e,t,{start:n}){if('"'!==e)return null;const{end:a,value:r}=function(e,t,n){return H('"',e,t,n)}(n,t);return{type:"text",value:r,end:a}},function(e,t,{start:n}){if("#"!==e)return null;const{end:a,value:r}=z("#",n,t);return{type:"number",value:r,end:a}},function(e,t,{start:n}){return"\\"!==e?null:{type:"operator",...z("\\",n,t)}},function(e,t,{start:n,grouping:a}){if("\n"!==e)return null;let r=n,o=e,s="";for(;"\n"===o;)s+=o,r+=1,o=t[r];return{type:a?"sep.row":"space",value:s,end:r}},function(e,t,{start:n}){if("."===e){const e=t[n+1],a=X.get(`.${e}`);if(a){for(const e of J)if(e===t.slice(n+1,n+1+e.length))return null;return{type:"infix",value:a,end:n+2}}}const a=X.get(e);if(a){for(const e of J)if(e===t.slice(n,n+e.length))return null;return{type:"infix",value:a,end:n+1}}return null},function(e,t,{grouping:n,start:a},{colSep:r,rowSep:o}){if(!n)return null;const s=a+r.length,l=a+o.length;return t.slice(a,l)===o?{type:"sep.row",value:o,end:l}:t.slice(a,s)===r?{type:"sep.col",value:r,end:s}:null},function(e,t,{start:n}){let a=e;if(Y(a)){let[e]=t.slice(n+a.length),r=a+e;for(;e&&Y(r);)a+=e,[e]=t.slice(n+a.length),r=a+e}{const[e]=t.slice(n+a.length),r=a+e;if(U.has(r))return null}const r=W.get(a);return r?{...r,type:"paren.open",end:n+a.length}:function(e){return!!e&&I.test(e)}(e)?{type:"paren.open",value:e,end:n+e.length}:null},function(e,t,{grouping:n,start:a}){if(!n)return null;let r=e;if(V(r)){let[e]=t.slice(a+r.length),n=r+e;for(;e&&V(n);)r+=e,[e]=t.slice(a+r.length),n=r+e}{const[e]=t.slice(a+r.length),n=r+e;if(U.has(n))return null}const o=j.get(r);return o?{type:"paren.close",value:o.value,end:a+r.length}:F(e)?{type:"paren.close",value:e,end:a+e.length}:null},function(e,t,{start:n,grouping:a}){let r=e;if(K(r)){let[e]=t.slice(n+r.length),a=r+e;for(;e&&K(a);)r+=e,[e]=t.slice(n+r.length),a=r+e}const o=U.get(r);if(o)return{type:o.sep&&a?"sep.col":"operator",value:o.value,attrs:o.attrs,end:n+r.length};const s=q.get(r);if(s)return{type:"command",end:n+r.length,...s};if(!function(e){return!!e&&_.test(e)}(e))return null;const l={type:"operator",value:e,end:n+e.length};return"|"===e&&" "===t.at(n-1)&&" "===t.at(n+1)&&(l.attrs={stretchy:!0}),l}];function te(e){return null!==e}function ne(e){return t=>({tag:e,attrs:t.attrs,textContent:t.value})}function ae(e){return null!==e}function re(e,t){const{open:n,close:a,...r}=e.attrs||{},o={tag:`m${e.name}`,childNodes:e.items.map(t),attrs:r};return n||a?{tag:"mrow",childNodes:[{tag:"mo",textContent:`${n}`,attrs:{fence:!0}},o,{tag:"mo",textContent:`${a}`,attrs:{fence:!0}}]}:o}function oe(e,t){return`var(--mathup-${e}-${t}, ${t})`}function se(e,t){if(!e||!t)return t;const n=new Map;for(const[r,o]of e)if("background"===r){const e=n.get("background"),t=oe(r,o);e?n.set("background",`${e},${t}`):n.set("background",t)}else n.set(r,oe(r,o));let a=t.attrs?.style??"";for(const[r,o]of n)a+=`${r}:${o};`;return a?{...t,attrs:t.attrs?{...t.attrs,style:a}:{style:a}}:t}function le(e){return null!==e}function ue(e,t){let n="";for(const a of t)n+=e(a);return n}function ie(e,t){return n=>{if(t){const e=t.get(n);if(e)return e}const a=n.codePointAt(0);if(!a)return n;for(const[[t,r],o]of e)if(t<=a&&a<=r)return String.fromCodePoint(a+o);return n}}function ce([e,t]){return n=>[[e,t],n-e]}const pe=ce([48,57]),me=ce([65,90]),ve=ce([97,122]),fe=ce([913,937]),de=ce([945,969]),ge=ie([pe(120782),me(119808),ve(119834),fe(120488),de(120514)],new Map([["œ¥","ùöπ"],["‚àá","ùõÅ"],["‚àÇ","ùõõ"],["œµ","ùõú"],["œë","ùõù"],["œ∞","ùõû"],["œï","ùõü"],["œ±","ùõ†"],["œñ","ùõ°"],["œú","ùüä"],["œù","ùüã"]])),he=ie([me(119860),ve(119886),fe(120546),de(120572)],new Map([["h","‚Ñé"],["ƒ±","ùö§"],["»∑","ùö•"],["œ¥","ùõ≥"],["‚àá","ùõª"],["‚àÇ","ùúï"],["œµ","ùúñ "],["œë","ùúó"],["œ∞","ùúò"],["œï","ùúô"],["œ±","ùúö"],["œñ","ùúõ"]])),ye=ie([me(119912),ve(119938),fe(120604),de(120630)],new Map([["œ¥","ùú≠"],["‚àá","ùúµ"],["‚àÇ","ùùè"],["œµ","ùùê"],["œë","ùùë"],["œ∞","ùùí"],["œï","ùùì"],["œ±","ùùî"],["œñ","ùùï"]])),be=ie([pe(120792),me(120120),ve(120146)],new Map([["C","‚ÑÇ"],["H","‚Ñç"],["N","‚Ñï"],["P","‚Ñô"],["Q","‚Ñö"],["R","‚Ñù"],["Z","‚Ñ§"],["œÄ","‚Ñº"],["Œ≥","‚ÑΩ"],["Œ†","‚Ñø"],["‚àë","‚ÖÄ"]])),ke=ie([],new Map([["D","‚ÖÖ"],["d","‚ÖÜ"],["i","‚Öà"],["j","‚Öâ"]])),we=ie([me(120068),ve(120094)],new Map([["C","‚Ñ≠"],["H","‚Ñå"],["I","‚Ñë"],["R","‚Ñú"],["Z","‚Ñ®"]])),xe=ie([me(120172),ve(120198)]),Le=ie([pe(120822),me(120432),ve(120458)]),Oe=ie([pe(120802),me(120224),ve(120250)]),Me=ie([pe(120812),me(120276),ve(120302),fe(120662),de(120688)],new Map([["œ¥","ùùß"],["‚àá","ùùØ"],["‚àÇ","ùûâ"],["œµ","ùûä"],["œë","ùûã"],["œ∞","ùûå"],["œï","ùûç"],["œ±","ùûé"],["œñ","ùûè"]])),Ne=ie([me(120328),ve(120354)]),$e=ie([me(120380),ve(120406),fe(120720),de(120746)],new Map([["œ¥","ùû°"],["‚àá","ùû©"],["‚àÇ","ùüÉ"],["œµ","ùüÑ"],["œë","ùüÖ"],["œ∞","ùüÜ"],["œï","ùüá"],["œ±","ùüà"],["œñ","ùüâ"]])),Te=ie([me(119964),ve(119990)],new Map([["B","‚Ñ¨"],["E","‚Ñ∞"],["F","‚Ñ±"],["H","‚Ñã"],["I","‚Ñê"],["L","‚Ñí"],["M","‚Ñ≥"],["R","‚Ñõ"],["e","‚ÑØ"],["g","‚Ñä"],["o","‚Ñ¥"]])),Ce=ie([me(120016),ve(120042)]);function Se(e){return`var(--mathup-font-family-${e}, ${e})`}function Ae(e,t){const n=new Map;if(t.includes("bold")&&n.set("font-weight","bold"),t.includes("italic")&&n.set("font-style","italic"),t.includes("sans-serif")?n.set("font-family",Se("sans-serif")):t.includes("monospace")&&n.set("font-family",Se("monospace")),0===n.size)return e;let a="";for(const[r,o]of n)a+=`${r}:${o};`;return{...e,style:a}}function Ee(e,t){return t.includes("double-struck")?ue(be,e):t.includes("script")?ue(Te,e):t.includes("fraktur")?ue(we,e):e}function Be(e,t){return t.includes("bold")?t.includes("italic")?t.includes("sans-serif")?ue($e,e):ue(ye,e):t.includes("script")?ue(Ce,e):t.includes("fraktur")?ue(xe,e):t.includes("sans-serif")?ue(Me,e):ue(ge,e):t.includes("italic")?t.includes("double-struck")?ue(ke,e):t.includes("sans-serif")?ue(Ne,e):ue(he,e):t.includes("sans-serif")?ue(Oe,e):t.includes("monospace")?ue(Le,e):Ee(e,t)}function _e(e,t){if(Array.isArray(e))return e.map(e=>_e(e,t));if("TextLiteral"===e.type){const{attrs:n={},transforms:a=[]}=t;return{...e,attrs:Ae(n,a),value:Ee(e.value,a)}}if("IdentLiteral"===e.type&&1===e.value.length&&t.transforms&&1===t.transforms.length&&"normal"===t.transforms[0])return{...e,attrs:{...e.attrs??{},mathvariant:"normal"}};if("IdentLiteral"===e.type||"NumberLiteral"===e.type||"OperatorLiteral"===e.type){const{transforms:n=[]}=t;return{...e,value:Be(e.value,n)}}return"MultiScripts"===e.type?{...e,base:_e(e.base,t)}:"items"in e?{...e,items:e.items.map(e=>_e(e,t))}:e}const Ge=new Map([["BinaryOperation",re],["FencedGroup",function(e,t){const n=e.items.map(e=>1===e.length?t(e[0]):{tag:"mrow",childNodes:e.map(t).filter(te)}).reduce((t,n,a)=>{t?.childNodes?.push(n);const r=e.attrs.seps[a];if(r){const{value:e,attrs:n={}}=r;t?.childNodes?.push({tag:"mo",textContent:e,attrs:{...n,separator:!0}})}return t},{tag:"mrow",childNodes:[]}),{open:a,close:r}=e.attrs;if(n&&!a.value&&!r?.value)return n;const o=[];return a.value&&o.push({tag:"mo",textContent:a.value,attrs:{...a.attrs,fence:"true"}}),1===n?.childNodes?.length?o.push(n.childNodes[0]):o.push(n),r?.value&&o.push({tag:"mo",textContent:r.value,attrs:{...r.attrs,fence:"true"}}),{tag:"mrow",childNodes:o}}],["IdentLiteral",ne("mi")],["MatrixGroup",function(e,t){const n=[],a=e.items.reduce((e,t)=>Math.max(e,t.length),0),{open:r,close:o}=e.attrs,s=o?.value?[]:Array.from({length:a}).fill("start");return r.value&&n.push({tag:"mo",textContent:r.value,attrs:{...r.attrs,fence:"true"}}),n.push({tag:"mtable",childNodes:e.items.map(e=>({tag:"mtr",childNodes:e.map((e,n)=>({tag:"mtd",attrs:s[n]?{style:`text-align: ${s[n]}`}:{},childNodes:e.map(t).filter(ae)}))}))}),o?.value&&n.push({tag:"mo",textContent:o.value,attrs:{...o.attrs,fence:"true"}}),{tag:"mrow",childNodes:n}}],["MultiScripts",function(e,t){const n=e.post.flatMap(e=>e.map(e=>1===e.length?t(e[0]):{tag:"mrow",childNodes:e.map(t)})),a=[t(e.base),...n];if(e.pre&&e.pre.length>0){a.push({tag:"mprescripts"});const n=e.pre.flatMap(e=>e.map(e=>1===e.length?t(e[0]):{tag:"mrow",childNodes:e.map(t)}));a.push(...n)}return{tag:"mmultiscripts",childNodes:a}}],["NumberLiteral",ne("mn")],["OperatorLiteral",ne("mo")],["Sentence",function(e,t,n){const a={};return n.dir&&(a.dir=n.dir),n.display&&(a.display=n.display),{tag:"math",attrs:a,childNodes:e.body.map(t).filter(e=>null!==e)}}],["SpaceLiteral",function(e){return"0ex"===e.attrs.width?null:{tag:"mspace",attrs:e.attrs}}],["Term",function(e,t){return 1===e.items.length&&le(e.items[0])?se(e.styles,t(e.items[0])):se(e.styles,{tag:"mrow",childNodes:e.items.map(t).filter(le)})}],["TernaryOperation",re],["TextLiteral",ne("mtext")],["UnaryOperation",function(e,t){if("command"===e.name)return se(e.styles,t(_e(e.items[0],e)));if("fence"===e.name){const{open:n,close:a}=e.attrs||{};return{tag:"mrow",childNodes:[{tag:"mo",attrs:{fence:!0},textContent:`${n}`},1===e.items.length?t(e.items[0]):{tag:"mrow",childNodes:e.items.map(t)},{tag:"mo",attrs:{fence:!0},textContent:`${a}`}]}}const n=`m${e.name}`;let[a]=e.items;if("Term"===a.type&&1===a.items.length&&([a]=a.items),e.accent){const r=e.attrs?{...e.attrs}:{};"over"===e.name?(r.accent=!0,"IdentLiteral"===a.type&&("i"===a.value?a.value="ƒ±":"j"===a.value&&(a.value="»∑"))):"under"===e.name&&(r.accentunder=!0);return{tag:n,childNodes:[t(a),{tag:"mo",textContent:e.accent}],attrs:r}}return{tag:n,childNodes:[t(a)],attrs:e.attrs}}]]);function Fe({bare:e=!1,dir:t=null,display:n=null,decimalMark:a=".",colSep:r=(","===a?";":","),rowSep:o=(";"===r?";;":";")}){const s={decimalMark:a,colSep:r,rowSep:o},l={dir:t,display:n},u={bare:e};return function(e){const t=function(e){function t(t,n){const[a]=t.slice(n.start);for(const r of ee){const o=r(a,t,n,e);if(o)return o}return function(e,t,{start:n}){return{type:"ident",value:e,end:n+e.length}}(a,0,n)}return function*(e){let n=0,a=0;for(;n<e.length;){const{type:r,value:o,end:s,split:l,extraTokensAfter:u,...i}=t(e,{start:n,grouping:a>0});if(l){let e="";for(const t of o)A(t)?e+=t:e?(yield{type:r,value:e},e=t):e=t;e&&(yield{type:r,value:e})}else yield{type:r,value:o,...i};if(u)for(const e of u)yield e;n=s,"paren.open"===r?a+=1:"paren.close"===r&&a>0&&(a-=1)}}}(s),n=function(e){const t=[];let n=0;for(;n<e.length;){const a=x({tokens:e,start:n,stack:t,nestLevel:1});n=a.end,t.push(a.node)}return{type:"Sentence",body:t}}([...t(e)]);var a;const r=(a=l,function e(t){const n=Ge.get(t.type);return n?n(t,e,a):null})(n);if(!r)throw new Error("Failed parsing AST");return{toDOM:()=>L(r,u),toString:()=>O(r,u),updateDOM:e=>M(e,r,u)}}}function Ie(e,t={}){return Fe(t)(e)}export{Ie as default};
